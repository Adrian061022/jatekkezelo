<div class="modal-overlay" *ngIf="isOpen" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üí≥ Egyenleg felt√∂lt√©s</h2>
      <button class="close-btn" (click)="onClose()" [disabled]="isProcessing">√ó</button>
    </div>

    <div class="modal-body">
      <!-- Amount Selection -->
      <div class="section">
        <label class="section-title">V√°lassz √∂sszeget</label>
        <div class="amount-grid">
          <button
            *ngFor="let amt of amounts"
            [class.active]="amount === amt"
            (click)="selectAmount(amt)"
            class="amount-btn"
            [disabled]="isProcessing"
          >
            ${{ amt }}
          </button>
        </div>
        <div class="custom-amount">
          <label for="customAmount">Egyedi √∂sszeg:</label>
          <input
            id="customAmount"
            type="number"
            [(ngModel)]="amount"
            min="1"
            max="10000"
            placeholder="$"
            [disabled]="isProcessing"
          />
        </div>
      </div>

      <!-- Card Type Selection -->
      <div class="section">
        <label class="section-title">K√°rtya t√≠pusa</label>
        <div class="card-types">
          <button
            *ngFor="let type of cardTypes"
            [class.active]="cardType === type.value"
            (click)="cardType = type.value"
            class="card-type-btn"
            [disabled]="isProcessing"
          >
            <span class="card-icon">{{ type.icon }}</span>
            <span>{{ type.label }}</span>
          </button>
        </div>
      </div>

      <!-- Card Details -->
      <div class="section">
        <label class="section-title">K√°rtya adatok</label>
        
        <div class="form-group">
          <label for="cardNumber">K√°rtyasz√°m</label>
          <input
            id="cardNumber"
            type="text"
            [(ngModel)]="cardNumber"
            (input)="formatCardNumber()"
            placeholder="1234 5678 9012 3456"
            maxlength="19"
            [disabled]="isProcessing"
            required
          />
        </div>

        <div class="form-group">
          <label for="cardHolder">K√°rtyabirtokos neve</label>
          <input
            id="cardHolder"
            type="text"
            [(ngModel)]="cardHolder"
            placeholder="KISS J√ÅNOS"
            style="text-transform: uppercase"
            [disabled]="isProcessing"
            required
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="expiryMonth">Lej√°rat</label>
            <div class="expiry-group">
              <select
                id="expiryMonth"
                [(ngModel)]="expiryMonth"
                [disabled]="isProcessing"
                required
              >
                <option value="">H√≥nap</option>
                <option *ngFor="let month of months" [value]="month">{{ month }}</option>
              </select>
              <span class="separator">/</span>
              <select
                id="expiryYear"
                [(ngModel)]="expiryYear"
                [disabled]="isProcessing"
                required
              >
                <option value="">√âv</option>
                <option *ngFor="let year of years" [value]="year">{{ year }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="cvv">CVV/CVC</label>
            <input
              id="cvv"
              type="text"
              [(ngModel)]="cvv"
              (input)="formatCVV()"
              placeholder="123"
              maxlength="4"
              [disabled]="isProcessing"
              required
            />
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message">
        ‚ö†Ô∏è {{ errorMessage }}
      </div>

      <!-- Processing Message -->
      <div *ngIf="isProcessing" class="processing-message">
        <div class="spinner"></div>
        <p>Fizet√©s feldolgoz√°sa...</p>
      </div>
    </div>

    <div class="modal-footer">
      <button
        class="btn btn-cancel"
        (click)="onClose()"
        [disabled]="isProcessing"
      >
        M√©gse
      </button>
      <button
        class="btn btn-pay"
        (click)="processPayment()"
        [disabled]="!isFormValid() || isProcessing"
      >
        <span *ngIf="!isProcessing">üí∞ Fizet√©s: ${{ amount }}</span>
        <span *ngIf="isProcessing">Feldolgoz√°s...</span>
      </button>
    </div>
  </div>
</div>
